<!DOCTYPE html>
<html lang="id" class="scroll-smooth" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pemilihan Ketua</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class', // pakai class untuk dark mode
      theme: {
        extend: {
          colors: {
            primary: "#3b82f6",
            primaryDark: "#2563eb",
          },
          boxShadow: {
            card: "0 4px 12px rgba(59, 130, 246, 0.1)",
            cardDark: "0 4px 12px rgba(37, 99, 235, 0.3)",
          },
        },
      },
    };
  </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col items-center p-6 transition-colors duration-300">

  <header class="mb-10 text-center">
    <h1 class="text-4xl font-extrabold text-gray-900 dark:text-gray-100 tracking-tight">
      Pemilihan Ketua Organisasi
    </h1>
    <p class="mt-2 text-gray-600 dark:text-gray-400">Pilih maksimal 2 kandidat</p>
  </header>

  <main id="cards" class="grid grid-cols-1 sm:grid-cols-2 gap-8 w-full max-w-4xl">
    <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-card dark:shadow-cardDark p-6 flex flex-col items-center space-y-4 transition-shadow hover:shadow-lg">
      <img src="img/1.jpg" alt="Kandidat 1" class="w-28 h-28 rounded-full ring-2 ring-primary dark:ring-primaryDark object-cover" />
      <h2 class="font-semibold text-xl text-gray-900 dark:text-gray-100">Kandidat 1</h2>
      <button onclick="vote('Al UStadz Amin', this)" class="vote-btn w-full max-w-xs bg-primary hover:bg-primaryDark text-white font-medium py-2 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
        Pilih
      </button>
    </div>

    <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-card dark:shadow-cardDark p-6 flex flex-col items-center space-y-4 transition-shadow hover:shadow-lg">
      <img src="img/1.jpg" alt="Kandidat 2" class="w-28 h-28 rounded-full ring-2 ring-primary dark:ring-primaryDark object-cover" />
      <h2 class="font-semibold text-xl text-gray-900 dark:text-gray-100">Kandidat 2</h2>
      <button onclick="vote('Al UStadz Dwi', this)" class="vote-btn w-full max-w-xs bg-primary hover:bg-primaryDark text-white font-medium py-2 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
        Pilih
      </button>
    </div>

    <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-card dark:shadow-cardDark p-6 flex flex-col items-center space-y-4 transition-shadow hover:shadow-lg">
      <div class="w-28 h-28 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400 text-3xl font-bold select-none">
        3
      </div>
      <h2 class="font-semibold text-xl text-gray-900 dark:text-gray-100">Kandidat 3</h2>
      <button onclick="vote('Al UStadz Sigap', this)" class="vote-btn w-full max-w-xs bg-primary hover:bg-primaryDark text-white font-medium py-2 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
        Pilih
      </button>
    </div>

    <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-card dark:shadow-cardDark p-6 flex flex-col items-center space-y-4 transition-shadow hover:shadow-lg">
      <div class="w-28 h-28 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400 text-3xl font-bold select-none">
        4
      </div>
      <h2 class="font-semibold text-xl text-gray-900 dark:text-gray-100">Kandidat 4</h2>
      <button onclick="vote('Al UStadz Raja', this)" class="vote-btn w-full max-w-xs bg-primary hover:bg-primaryDark text-white font-medium py-2 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
        Pilih
      </button>
    </div>
  </main>

  <section class="mt-12 w-full max-w-md text-center space-y-4">
    <input id="resetKey" type="password" placeholder="Masukkan reset key" autocomplete="off"
      class="w-2/3 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition" />
    <button onclick="resetVotes()" class="ml-2 px-5 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold transition">
      Reset
    </button>
  </section>

  <!-- Loading Dialog -->
  <div id="loading" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg flex items-center space-x-4">
      <svg class="animate-spin h-7 w-7 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
      </svg>
      <span class="text-gray-700 dark:text-gray-200 font-medium">Menyimpan pilihan...</span>
    </div>
  </div>

  <!-- Success/Error Dialog -->
  <div id="messageDialog" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 px-4">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg text-center max-w-sm w-full">
      <h2 id="messageTitle" class="text-xl font-bold mb-3 text-gray-900 dark:text-gray-100"></h2>
      <p id="messageText" class="text-gray-700 dark:text-gray-300 mb-6"></p>
      <button onclick="closeMessage()" class="bg-primary hover:bg-primaryDark text-white px-6 py-2 rounded-lg font-semibold transition">
        OK
      </button>
    </div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyh-V0L-KQhx8AH79leEnOikOGM2YtXHwSaGzBesU0r7L9Mh42bM2gN0CJV8rTF3djQaA/exec";
    let selected = JSON.parse(localStorage.getItem("selectedVotes")) || [];

    window.onload = () => {
      selected.forEach(name => {
        const btn = findButton(name);
        if (btn) disableButton(btn, true);
      });
      if (selected.length >= 2) disableAllButtons();
    };

    function vote(name, btn) {
      if (selected.length >= 2) {
        showMessage("Batas Tercapai", "Kamu hanya bisa memilih 2 kandidat!");
        return;
      }

      showLoading();
      disableButton(btn, true);

      const device = localStorage.getItem("deviceId") || generateDeviceId();
      localStorage.setItem("deviceId", device);

      const data = new URLSearchParams();
      data.append("pilihan", name);
      data.append("device", device);

      fetch(scriptURL, { method: "POST", body: data })
        .then(res => res.json())
        .then(res => {
          hideLoading();
          if (res.status === "success") {
            selected.push(name);
            localStorage.setItem("selectedVotes", JSON.stringify(selected));
            disableButton(btn, true);
            if (selected.length >= 2) disableAllButtons();
            showMessage("Berhasil", "Vote untuk " + name + " berhasil disimpan!");
          } else {
            disableButton(btn, false);
            showMessage("Gagal", "Gagal menyimpan vote: " + res.message);
          }
        })
        .catch(err => {
          hideLoading();
          disableButton(btn, false);
          showMessage("Error", "Terjadi kesalahan: " + err);
        });
    }

    function disableButton(btn, permanently) {
      btn.disabled = true;
      btn.classList.remove("bg-primary", "hover:bg-primaryDark");
      btn.classList.add("bg-gray-400", "cursor-not-allowed");
      btn.textContent = permanently ? "Sudah Dipilih" : "Pilih";
    }

    function disableAllButtons() {
      document.querySelectorAll(".vote-btn").forEach(b => {
        if (!b.disabled) disableButton(b, false);
      });
    }

    function resetVotes() {
      const key = document.getElementById("resetKey").value.trim();
      if (key === "RESET123") {
        localStorage.removeItem("selectedVotes");
        selected = [];
        location.reload();
      } else {
        showMessage("Reset Gagal", "Reset key salah!");
      }
    }

    function generateDeviceId() {
      return "device-" + Math.random().toString(36).slice(2, 11);
    }

    function showLoading() {
      document.getElementById("loading").classList.remove("hidden");
    }

    function hideLoading() {
      document.getElementById("loading").classList.add("hidden");
    }

    function showMessage(title, text) {
      document.getElementById("messageTitle").innerText = title;
      document.getElementById("messageText").innerText = text;
      document.getElementById("messageDialog").classList.remove("hidden");
    }

    function closeMessage() {
      document.getElementById("messageDialog").classList.add("hidden");
    }

    function findButton(name) {
      return [...document.querySelectorAll(".vote-btn")]
        .find(b => b.getAttribute("onclick").includes(name));
    }
  </script>
</body>
</html>
