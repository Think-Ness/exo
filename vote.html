<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pemilihan Ketua</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-2xl font-bold mb-6">Pemilihan Ketua Organisasi</h1>

  <div id="cards" class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-3xl">
    <!-- Kandidat 1 -->
    <div class="card bg-white shadow-md rounded-xl p-4 flex flex-col items-center">
        <img src="https://via.placeholder.com/120" class="w-24 h-24 rounded-full mb-4">
      <h2 class="font-semibold text-lg">Kandidat 1</h2>
      <p class="text-gray-500 text-sm mb-4">Deskripsi singkat kandidat 2</p>
      <button onclick="vote('Kandidat 1', this)" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
        Pilih
      </button>
    </div>
    <!-- Kandidat 2 -->
    <div class="card bg-white shadow-md rounded-xl p-4 flex flex-col items-center">
        <img src="https://via.placeholder.com/120" class="w-24 h-24 rounded-full mb-4">
      <h2 class="font-semibold text-lg">Kandidat 2</h2>
      <p class="text-gray-500 text-sm mb-4">Deskripsi singkat kandidat 2</p>
      <button onclick="vote('Kandidat 2', this)" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
        Pilih
      </button>
    </div>
    <!-- Kandidat 3 -->
    <div class="card bg-white shadow-md rounded-xl p-4 flex flex-col items-center">
        <img src="https://via.placeholder.com/120" class="w-24 h-24 rounded-full mb-4">
      <h2 class="font-semibold text-lg">Kandidat 3</h2>
      <p class="text-gray-500 text-sm mb-4">Deskripsi singkat kandidat 2</p>
      <button onclick="vote('Kandidat 3', this)" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
        Pilih
      </button>
    </div>
    <!-- Kandidat 4 -->
    <div class="card bg-white shadow-md rounded-xl p-4 flex flex-col items-center">
        <img src="https://via.placeholder.com/120" class="w-24 h-24 rounded-full mb-4">
      <h2 class="font-semibold text-lg">Kandidat 4</h2>
      <p class="text-gray-500 text-sm mb-4">Deskripsi singkat kandidat 2</p>
      <button onclick="vote('Kandidat 4', this)" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
        Pilih
      </button>
    </div>
  </div>

  <!-- Reset -->
  <div class="mt-8 w-full max-w-md text-center">
    <input id="resetKey" type="text" placeholder="Masukkan reset key"
      class="border rounded-lg px-4 py-2 w-2/3" />
    <button onclick="resetVotes()" class="ml-2 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
      Reset
    </button>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzidGgaynk8KQ91FsobMGrQJmK7jF8HlRO8pGvAqOtkuaMkwbGL0RVLQcqd-4aX89Xh7w/exec"; // ganti dengan URL Apps Script web app
    let selected = JSON.parse(localStorage.getItem("selectedVotes")) || [];

    // Disable kandidat yg sudah dipilih sebelumnya
    window.onload = () => {
      selected.forEach(name => {
        const btn = [...document.querySelectorAll("button")]
          .find(b => b.textContent.includes("Pilih") && b.getAttribute("onclick").includes(name));
        if (btn) disableButton(btn);
      });
    };

    function vote(name, btn) {
      if (selected.length >= 2) {
        alert("Kamu hanya bisa memilih 2 kandidat!");
        return;
      }

      const device = localStorage.getItem("deviceId") || generateDeviceId();
      localStorage.setItem("deviceId", device);

      const data = new URLSearchParams();
      data.append("pilihan", name);
      data.append("device", device);

      fetch(scriptURL, { method: "POST", body: data })
        .then(res => res.json())
        .then(res => {
          if (res.status === "success") {
            selected.push(name);
            localStorage.setItem("selectedVotes", JSON.stringify(selected));
            disableButton(btn);
            alert("Vote untuk " + name + " berhasil disimpan!");
          } else {
            alert("Gagal menyimpan vote: " + res.message);
          }
        })
        .catch(err => alert("Error: " + err));
    }

    function disableButton(btn) {
      btn.disabled = true;
      btn.classList.remove("bg-blue-500", "hover:bg-blue-600");
      btn.classList.add("bg-gray-400", "cursor-not-allowed");
      btn.textContent = "Sudah Dipilih";
    }

    function resetVotes() {
      const key = document.getElementById("resetKey").value;
      if (key === "RESET123") { // ubah sesuai key rahasia
        localStorage.removeItem("selectedVotes");
        selected = [];
        location.reload();
      } else {
        alert("Reset key salah!");
      }
    }

    function generateDeviceId() {
      return "device-" + Math.random().toString(36).substr(2, 9);
    }
  </script>
</body>
</html>
